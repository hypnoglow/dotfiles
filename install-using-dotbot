#!/bin/bash

set -e

CONFIG="install.conf.yaml"
DOTBOT_DIR="dotbot"

DOTBOT_BIN="bin/dotbot"
BASEDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

cd "${BASEDIR}"
git submodule update --init --recursive "${DOTBOT_DIR}"

"${BASEDIR}/${DOTBOT_DIR}/${DOTBOT_BIN}" -d "${BASEDIR}" -c "${CONFIG}" "${@}"

#
# Post process
#
DOTFILES_DIR="${BASEDIR}/src"
echo "Saving DOTFILES_ROOT to ~/.profile.d/dotfiles.sh"
cat <<EOF > "${DOTFILES_DIR}/.profile.d/dotfiles.sh"
# THIS FILE IS GENERATED DYNAMICALLY, DO NOT CHANGE IT.
export DOTFILES_ROOT="${DOTFILES_ROOT}"
EOF
